// SPDX-License-Identifier: (GPL-2.0+ OR MIT)
/*
 * Copyright (c) 2020 Rockchip Electronics Co., Ltd.
 *
 */

#include "rk3568-evb1-ddr4-v10.dtsi"
#include "rk3568-linux.dtsi"
#include <dt-bindings/display/rockchip_vop.h>

/ {
    boardtype = "RK3568 8897 board V1 (linux base)";

	chosen: chosen {
		bootargs = "earlycon=uart8250,mmio32,0xfe660000 console=ttyFIQ0 root=PARTUUID=614e0000-0000 rw rootwait";
	};

	fiq-debugger {
		compatible = "rockchip,fiq-debugger";
		rockchip,serial-id = <2>;
		rockchip,wake-irq = <0>;
		/* If enable uart uses irq instead of fiq */
		rockchip,irq-mode-enable = <1>;
		rockchip,baudrate = <115200>;  /* Only 115200 and 1500000 */
		interrupts = <GIC_SPI 252 IRQ_TYPE_LEVEL_LOW>;
		pinctrl-names = "default";
		pinctrl-0 = <&uart2m0_xfer>;
		status = "okay";
	};

    lvds_panel: lvds-panel {
		compatible = "simple-panel";
        status = "disabled";
    };

    edp_panel: edp-panel {
        compatible ="simple-panel";
        status = "disabled";
    };

    ryd_gpio_control:ryd-gpio-control {
        compatible = "ryd_gpio_control";
        #address-cells = <1>;
        #size-cells = <0>;

        pinctrl-names = "default";
        pinctrl-0 = <&gl3523_reset &usb_host_en &hub_rst &gpio3_a4_mux &gpio3_a5_mux &gpio3_b5 &gpio3_c1 &gpio0_c4>;
        status = "okay";

	   	gl3523_rst: gl3523-rst {
		    gpio = <&gpio4 RK_PD2 GPIO_ACTIVE_HIGH>;
            //can set dir_in, default is dir_out
		    pull_cfg = <0>; //<0>=null, <1>=pulldown, <2>=pullup
		    sys_create;  // if set, will export the gpio in sysfs
		    export;
	    };

	   	usb_host_en{
		    gpio = <&gpio0 RK_PC6 GPIO_ACTIVE_HIGH>;
            //can set dir_in, default is dir_out
		    pull_cfg = <0>; //<0>=null, <1>=pulldown, <2>=pullup
		    sys_create;  // if set, will export the gpio in sysfs
		    export;
	    };
/*
	   	pcie_pwren{
		    gpio = <&gpio2 RK_PD7 GPIO_ACTIVE_HIGH>;
            //can set dir_in, default is dir_out
		    pull_cfg = <0>; //<0>=null, <1>=pulldown, <2>=pullup
		    //sys_create;  // if set, will export the gpio in sysfs
		    //export;
	    };
*/
	    hub_rst {
		    gpio = <&gpio3 RK_PA0 GPIO_ACTIVE_HIGH>;
            //can set dir_in, default is dir_out
		    pull_cfg = <0>; //<0>=null, <1>=pulldown, <2>=pullup
		    //sys_create;  // if set, will export the gpio in sysfs
	    };

	    gpio3_a4:gpio3_a4   {
		    gpio = <&gpio3 RK_PA4 GPIO_ACTIVE_HIGH>;
            //can set dir_in, default is dir_out
		    pull_cfg = <0>; //<0>=null, <1>=pulldown, <2>=pullup
		    sys_create;  // if set, will export the gpio in sysfs
		    export;
	    };

	    gpio3_a5:gpio3_a5  {
		    gpio = <&gpio3 RK_PA5 GPIO_ACTIVE_HIGH>;
            //can set dir_in, default is dir_out
		    pull_cfg = <0>; //<0>=null, <1>=pulldown, <2>=pullup
		    sys_create;  // if set, will export the gpio in sysfs
		    export;
	    };

	    gpio3_b5 {
		    gpio = <&gpio3 RK_PB5 GPIO_ACTIVE_HIGH>;
            //can set dir_in, default is dir_out
		    pull_cfg = <0>; //<0>=null, <1>=pulldown, <2>=pullup
		    sys_create;  // if set, will export the gpio in sysfs
		    export;
	    };
	    gpio3_c1{
		    gpio = <&gpio3 RK_PC1 GPIO_ACTIVE_HIGH>;
            //can set dir_in, default is dir_out
		    pull_cfg = <0>; //<0>=null, <1>=pulldown, <2>=pullup
		    sys_create;  // if set, will export the gpio in sysfs
		    export;
	    };
	   	gpio0_c4{
		    gpio = <&gpio0 RK_PC4 GPIO_ACTIVE_HIGH>;
            //can set dir_in, default is dir_out
		    pull_cfg = <0>; //<0>=null, <1>=pulldown, <2>=pullup
		    sys_create;  // if set, will export the gpio in sysfs
		    export;
	    };
    };

	rk_modem: rk-modem {
		compatible="4g-modem-platdata";
		pinctrl-names = "default";
		pinctrl-0 = <&lte_power_en &lte_reset>;
		4G,vbat-gpio = <&gpio1 RK_PD3 GPIO_ACTIVE_HIGH>;
        4G,disable = <&gpio1 RK_PB0 GPIO_ACTIVE_HIGH>;
		4G,power = <&gpio0 RK_PA0 GPIO_ACTIVE_HIGH>;
		4G,reset = <&gpio1 RK_PB2 GPIO_ACTIVE_HIGH>;
		status = "okay";
	};
/*
    usb_host_en: usb-host-en {
        compatible = "regulator-fixed";
        regulator-name = "usb-host-en";
        gpio = <&gpio0 RK_PC6 GPIO_ACTIVE_HIGH>;
        regulator-min-microvolt = <3300000>;
        regulator-max-microvolt = <3300000>;
        enable-active-high;
        regulator-always-on;
        regulator-boot-on;
    };
*/
	vcc5v0_host1: vcc5v0-host1-regulator {
		compatible = "regulator-fixed";
		enable-active-high;
		gpio = <&gpio3 RK_PA1 GPIO_ACTIVE_HIGH>;
		pinctrl-names = "default";
		pinctrl-0 = <&vcc5v0_host1_en>;
		regulator-name = "vcc5v0_host1";
		regulator-always-on;
	};

	pcie30_3v3: gpio-regulator {
		compatible = "regulator-gpio";
		regulator-name = "pcie30_3v3";
		regulator-min-microvolt = <100000>;
		regulator-max-microvolt = <3300000>;
		gpios = <&gpio2 RK_PD7 GPIO_ACTIVE_HIGH>;
		gpios-states = <0x1>;
		states = <100000 0x0
			  3300000 0x1>;
	};
};

&wireless_bluetooth {
	compatible = "bluetooth-platdata";
	clocks = <&rk809 1>;
	clock-names = "ext_clock";
	//wifi-bt-power-toggle;
	uart_rts_gpios = <&gpio2 RK_PB1 GPIO_ACTIVE_LOW>;
	pinctrl-names = "default", "rts_gpio";
	pinctrl-0 = <&uart8m0_rtsn>;
	pinctrl-1 = <&uart8_gpios>;
	BT,reset_gpio    = <&gpio0 RK_PD4 GPIO_ACTIVE_HIGH>;
	BT,wake_gpio     = <&gpio0 RK_PD6 GPIO_ACTIVE_HIGH>;
	BT,wake_host_irq = <&gpio0 RK_PD5 GPIO_ACTIVE_HIGH>;
	status = "okay";
};

&gmac0 {
	snps,reset-gpio = <&gpio2 RK_PD0 GPIO_ACTIVE_LOW>;
	status = "okay";
};

&gmac1 {
	snps,reset-gpio = <&gpio3 RK_PB0 GPIO_ACTIVE_LOW>;
	status = "okay";
};

// EDP1 backlight
&pwm4 {
    status = "okay";
    pinctrl-names = "active";
    pinctrl-0 = <&pwm4_pins>;
};

&pwm5 {
    status = "disabled";
};

&pwm6 {
    status = "okay";
    pinctrl-names = "active";
    pinctrl-0 = <&pwm6_pins>;
};

// LVDS backlight
&pwm7 {
    status = "disabled";
    pinctrl-names = "active";
    pinctrl-0 = <&pwm7_pins>;
};

&dmc {
    compatible = "rockchip,rk3568-dmc";
    interrupts = <GIC_SPI 10 IRQ_TYPE_LEVEL_HIGH>;
    interrupt-names = "complete";
    devfreq-events = <&dfi>;
    //clocks = <&cru SCLK_DDRCLK>;
    clock-names = "dmc_clk";
    operating-points-v2 = <&dmc_opp_table>;

    system-status-freq = <
        /*system status         freq(KHz)*/
        SYS_STATUS_NORMAL       780000
        SYS_STATUS_REBOOT       1184000
        SYS_STATUS_SUSPEND      324000
        SYS_STATUS_VIDEO_4K     780000
        SYS_STATUS_VIDEO_4K_10B 780000
        SYS_STATUS_BOOST        1184000
        SYS_STATUS_ISP          1184000
        SYS_STATUS_PERFORMANCE  1184000
        SYS_STATUS_DUALVIEW     1184000
    >;

    status = "okay";
};

&dmc_opp_table{
    compatible = "operating-points-v2";

    mbist-vmin = <825000 900000 950000>;
    nvmem-cells = <&log_leakage>, <&core_pvtm>, <&mbist_vmin>;
    nvmem-cell-names = "leakage", "pvtm", "mbist-vmin";
    rockchip,temp-hysteresis = <5000>;
    rockchip,low-temp = <0>;
    rockchip,low-temp-adjust-volt = <
        /* MHz    MHz    uV */
            0      1560   25000
    >;
    rockchip,leakage-voltage-sel = <
            1   80    0
            81  254   1
    >;

    opp-324000000 {
        opp-hz = /bits/ 64 <324000000>;
        opp-microvolt = <900000>;
        opp-microvolt-L0 = <900000>;
        opp-microvolt-L1 = <850000>;
    };
    opp-528000000 {
        opp-hz = /bits/ 64 <528000000>;
        opp-microvolt = <900000>;
        opp-microvolt-L0 = <900000>;
        opp-microvolt-L1 = <850000>;
    };
    opp-780000000 {
        opp-hz = /bits/ 64 <780000000>;
        opp-microvolt = <900000>;
        opp-microvolt-L0 = <900000>;
        opp-microvolt-L1 = <850000>;
    };
    opp-920000000 {
        opp-hz = /bits/ 64 <920000000>;
        opp-microvolt = <900000>;
        opp-microvolt-L0 = <900000>;
        opp-microvolt-L1 = <850000>;
    };
    opp-1184000000 {
        opp-hz = /bits/ 64 <1184000000>;
        opp-microvolt = <900000>;
        opp-microvolt-L0 = <900000>;
        opp-microvolt-L1 = <850000>;
    };
    opp-1560000000 {
        opp-hz = /bits/ 64 <1560000000>;
        opp-microvolt = <900000>;
        opp-microvolt-L0 = <900000>;
        opp-microvolt-L1 = <850000>;
        status = "disabled";
    };
};

&i2c0 {
    status = "okay";
};

&i2c4 {
    status = "disabled";
};

&i2c5 {
    status = "okay";

	hym8563: hym8563@51 {
		compatible = "haoyu,hym8563";
		reg = <0x51>;

		interrupt-parent = <&gpio0>;
		interrupts = <RK_PD3 IRQ_TYPE_EDGE_FALLING>;

		pinctrl-names = "default";
		pinctrl-0 = <&pmic_int>;

		#clock-cells = <0>;
		clock-output-names = "xin32k";
	};
};

&rk809 {
	rtc {
		status = "disabled";
	};
};

// MIPI-DSI configuration
&dsi0 {
	status = "disabled";
};


&dsi0_in_vp0 {
	status = "disabled";
};

&dsi0_in_vp1 {
    status = "disabled";
};

&sdmmc0 {
	max-frequency = <150000000>;
	supports-sd;
	bus-width = <4>;
	cap-mmc-highspeed;
	cap-sd-highspeed;
	disable-wp;
	sd-uhs-sdr104;
	vmmc-supply = <&vcc3v3_sd>;
	vqmmc-supply = <&vccio_sd>;
	pinctrl-names = "default";
	pinctrl-0 = <&sdmmc0_bus4 &sdmmc0_clk &sdmmc0_cmd &sdmmc0_det>;
	status = "okay";
};

&pmu_io_domains {
	status = "okay";
	pmuio1-supply = <&vcc3v3_pmu>;
	pmuio2-supply = <&vcc3v3_pmu>;
	vccio1-supply = <&vccio_acodec>;
	vccio3-supply = <&vccio_sd>;
	vccio4-supply = <&vcc_1v8>;
	vccio5-supply = <&vcc_3v3>;
	vccio6-supply = <&vcc_1v8>;
	vccio7-supply = <&vcc_3v3>;

};

&vcc3v3_lcd0_n {
	gpio = <&gpio0 RK_PC5 GPIO_ACTIVE_HIGH>;
	enable-active-high;
    regulator-always-on;
};

&vcc3v3_lcd1_n {
	gpio = <&gpio0 RK_PC7 GPIO_ACTIVE_HIGH>;
	enable-active-high;
    regulator-always-on;
};

&backlight {
    status = "okay";
	pwms = <&pwm4 0 500000 0>;
    enable-gpios = <&gpio3 RK_PA2 GPIO_ACTIVE_LOW>;
    pinctrl-0 = <&lcd0_bl_en>;      
	brightness-levels = <
			255	254	253	252	251	250	249	248	
		 	247 246 245 244 243 242 241 240
			239 238 237 236 235 234 233 232 
			231 230 229 228 227 226 225 224 
			223 222 221 220 219 218 217 216 
			215 214 213 212 211 210 209 208 
			207 206 205 204 203 202 201 200 
			199 198 197 196 195 194 193 192 
			191 190 189 188 187 186 185 184 
			183 182 181 180 179 178 177 176 
			175 174 173 172 171 170 169 168 
			167 166 165 164 163 162 161 160 
			159 158 157 156 155 154 153 152 
			151 150 149 148 147 146 145 144 
			143 142 141 140 139 138 137 136 
			135 134 133 132 131 130 129 128 
			127 126 125 124 123 122 121 120 
			119 118 117 116 115 114 113 112 
			111 110 109 108 107 106 105 104 
			103 102 101 100 99 	98 	97 	96 
			95 	94 	93 	92 	91 	90 	89 	88 
			87 	86 	85 	84 	83 	82 	81 	80 
			79 	78 	77 	76 	75 	74 	73	72 
			71 	70 	69 	68 	67 	66 	65 	64 
			63 	62 	61 	60 	59 	58 	57 	56 
			55 	54 	53 	52 	51 	50 	49 	48 
			47 	46 	45 	44 	43 	42 	41 	40 
			39 	38 	37 	36 	35 	34 	33 	32 
			31 	30 	29 	28 	27 	26 	25 	24 
			23 	22 	21 	20	19	18	17	16
			15	14	13	12	11	10	9	8
			7	6	5	4	3	2	1	0>;
	default-brightness-level = <200>;
};

&uart0 {
    status = "disabled";
};

&uart1 {
    status = "disabled";
    pinctrl-names = "default";
    pinctrl-0 = <&uart1m1_xfer>;
};
&uart3 {
    status = "okay";
    pinctrl-names = "default";
    pinctrl-0 = <&uart3m1_xfer>;
};
&uart4 {
    status = "okay";
    pinctrl-names = "default";
    pinctrl-0 = <&uart4m1_xfer>;
};
&uart7 {
    status = "okay";
    pinctrl-names = "default";
    pinctrl-0 = <&uart7m1_xfer>;
};
&uart9 {
    status = "okay";
    pinctrl-names = "default";
    pinctrl-0 = <&uart9m1_xfer>;
};


// MUST disable PCI-E function, 
// otherwise kernel will stall
&pcie30phy {
    status = "okay";
};

&pcie3x2 {
	reset-gpios = <&gpio2 RK_PD6 GPIO_ACTIVE_HIGH>;
	vpcie3v3-supply = <&pcie30_3v3>;
	max-link-speed= <3>;
	status = "okay";
};

&rk809_codec {
    status = "okay";
    hp-volume = <3>;
    spk-ctl-gpios =<&gpio3 RK_PC3 GPIO_ACTIVE_HIGH>;
    pinctrl-names = "default";
    pinctrl-0 = <&spk_ctl_gpios &i2s1m0_mclk>;
    spk-volume = <3>;
};

&pwm11 {
    status = "disabled";
};

&spdif_out {
    status = "disabled";
};

&spdif_8ch {
    status = "disabled";
};

&can1 {
    status = "okay";

	assigned-clocks = <&cru CLK_CAN1>;
	assigned-clock-rates = <100000000>;
};

&usbdrd_dwc3 {
    dr_mode = "host";
    status = "okay";
};

&pinctrl {
    backlight {
        lcd0_bl_en: lcd0_bl_en {
            rockchip,pins = <3 RK_PA2 RK_FUNC_GPIO &pcfg_pull_down>;
        };
/*
        lcd1_bl_en: lcd1_bl_en {
            rockchip,pins = <3 RK_PB6 RK_FUNC_GPIO &pcfg_pull_down>;
        };
*/
    };
    rk809{
        spk_ctl_gpios: spk-ctl-gpios{
           rockchip,pins = <RK_GPIO4 RK_PC0 RK_FUNC_GPIO &pcfg_pull_none>;
        };
    };
    pwm4 {
        pwm4_pins: pwm4-pins {
            rockchip,pins = <0 RK_PC3 RK_FUNC_1 &pcfg_pull_none>;
        };
    };
    pwm6 {
        pwm6_pins: pwm6-pins {
            rockchip,pins = <0 RK_PC5 RK_FUNC_1 &pcfg_pull_none>;
        };
    };
    usb {
        vcc5v0_host1_en: vcc5v0-host1-en {
            rockchip,pins = <3 RK_PA1 RK_FUNC_GPIO &pcfg_pull_none>;
        };
    };
    rk-modem {
        lte_power_en: lte-power-en {
            rockchip,pins = <0 RK_PA0 RK_FUNC_GPIO &pcfg_pull_up>;
        };
        lte_reset: lte-reset {
            rockchip,pins = <1 RK_PB2 RK_FUNC_GPIO &pcfg_pull_none>;
        };
    };

    ryd_gpio_control {
        gl3523_reset: gl3523-reset {
            rockchip,pins = <RK_GPIO4 RK_PD2 RK_FUNC_GPIO &pcfg_pull_none>;
        };
        hub_rst: usb-otg-en {
            rockchip,pins = <RK_GPIO3 RK_PA0 RK_FUNC_GPIO &pcfg_pull_none>;
        };
        usb_host_en: usb-host-en {
            rockchip,pins = <RK_GPIO0 RK_PC6 RK_FUNC_GPIO &pcfg_pull_none>;
		};
        cash_pr_en: cash-pr-en {
            rockchip,pins = <RK_GPIO3 RK_PB0 RK_FUNC_GPIO &pcfg_pull_none>;
        };

        gpio3_a4_mux: gpio3-a4-mux {
            rockchip,pins = <RK_GPIO3 RK_PA4 RK_FUNC_GPIO &pcfg_pull_none>;
        };
        gpio3_a5_mux: gpio3-a5-mux {
            rockchip,pins = <RK_GPIO3 RK_PA5 RK_FUNC_GPIO &pcfg_pull_none>;
        };

        gpio3_b5: gpio3-b5 {
            rockchip,pins = <RK_GPIO3 RK_PB5 RK_FUNC_GPIO &pcfg_pull_none>;
        };
        gpio3_c1: gpio3-c1 {
            rockchip,pins = <RK_GPIO3 RK_PC1 RK_FUNC_GPIO &pcfg_pull_none>;
        };
        gpio0_c4: gpio0-c4 {
            rockchip,pins = <RK_GPIO0 RK_PC4 RK_FUNC_GPIO &pcfg_pull_none>;
        };
    };
};
